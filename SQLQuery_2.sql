CREATE DATABASE QUANLYSINHVIEN

CREATE TABLE KHOA (
    MAKHOA CHAR(2) NOT NULL PRIMARY KEY,
    TENKHOA CHAR(15) NOT NULL,
);

CREATE TABLE MONHOC (
    MAMH CHAR(2) NOT NULL PRIMARY KEY,
    TENMH CHAR(25) NOT NULL,
    SOTIET INTEGER,
);

CREATE TABLE SINHVIEN (
    MASV CHAR(3) NOT NULL PRIMARY KEY,
    HOSV CHAR(25) NOT NULL,
    TENSV CHAR(7) NOT NULL,
    NAM CHAR(1) NOT NULL CHECK(NAM IN ('Y','N')),
    NGAYSINH DATE NOT NULL,
    NOISINH CHAR(15) NOT NULL,
    DIACHI CHAR(30) NOT NULL,
    QUAN CHAR(2) NOT NULL,
    MAKH CHAR(2) NOT NULL,
    HOCBONG INTEGER,
    LYLICH IMAGE NOT NULL,
    CONSTRAINT KN_MAKH FOREIGN KEY (MAKH) REFERENCES KHOA(MAKHOA),
);

CREATE TABLE KETQUA (
    MASV CHAR(3) NOT NULL,
    MAMH CHAR(2) NOT NULL,
    DIEM FLOAT,
    CONSTRAINT KN_MASV FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
    CONSTRAINT KN_MAMH FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
);

INSERT INTO KHOA VALUES
('AV','ANH VAN'),
('TH','TIN HOC'),
('TR','TRIET'),
('VL','VAT LY');

INSERT INTO MONHOC VALUES
('01','CO SO DU LIEU','60'),
('02','TRI TUE NHAN TAO','45'),
('03','TRUEYN TIN','45'),
('04','DO HOA','45'),
('05','VAN PHAM','90'),
('06','DAM THOAI','120'),
('07','VAT LY NGUYEN TU','60'),
('08','VAT LY DIA CAU','45'),
('09','TRIET HOC DONG','45'),
('10','TRIET HOC TAY','45');

INSERT INTO SINHVIEN VALUES
('A01', 'NGUYEN THI', 'HAI', 'N', '1997-02-23', 'SAI GON', '12 BIS VO VAN TAN', 'Q3', 'TH', 10000, 'SINH VIEN KHA'),
('A02', 'Tran Van',	'Chinh', 'Y',	'1997-12-24',	'SAI GON', '34 Nguyen Thong', 'Q1',	'TH', 13000, ''),
('A03', 'Luu Thi',	'Yen', 'N', '1997-02-21', 'HA NOI',	'757 Pastuer',	'Q3', 'TH',	14000, ''),
('A04',	'Tran Anh',	'Tuan',	'Y',	'1997-08-12',	'Long An',	'12 Đien Bien',	'BT',	'AV', 80000, ''),
('A05',	'Tran Thanh', 	'Trieu', 'Y', '1997-01-02',	'Ha Noi',	'3 Nguyen Thong',	'Q3',	'AV',	80000, ''),
('A06',	'Nguyen Van',	'Chinh', 'Y',	'1997-01-01',	'Sai Gon',	'5 Nguyen Thong',	'Q5',	'AV',	12000, ''),
('B01',	'Tran Thanh',	'Mai',	'N',	'1997-12-20',	'Ben Tre',	'567 Hai Ba Trung',	'Q1',	'TH',	0, ''),
('B02',	'Tran Thi',	'Thuy',	'N',	'1997-02-13',	'Sai Gon', 	'400/3 An Lac',	'BC',	'TH',	0, ''),
('B03',	'Tran Thi',	'Thanh', 'N',	'1997-12-31',	'Sai Gon',	'103 Nguyen Thong',	'BT', 'AV',	0, ''),
('B04',	'Tran Xuan', 'Dieu', 'Y',	'1997-12-20',	'Sai Gon', 	'10 Nguyen Thong',	'Q1',	'AV',	14000, ''),
('C01',	'Hoang Xuan', 'Quy', 'Y',	'1997-10-20',	'Daklak', '56/8 Hoang Van Thu', 'BT', 'AV', 0, '');

INSERT INTO KETQUA VALUES
('A06','06','8'),
('B01','01','7'),
('B01','03','3'),
('B02','02','6'),
('B02','04','10'),
('B03','01','7'),
('B03','03','6'),
('B04','05','3'),
('B04','06','4'),
('A01','01','2'),
('A01','03','9'),
('A02','01','7.5'),
('A02','03','10'),
('A02','05','9'),
('A02','06','6.5'),
('A03','01','5'),
('A03','03','3'),
('A04','05','10'),
('A05','05','4');

--CAU 1
SELECT *
FROM SINHVIEN
ORDER BY TENSV
--CAU 2
SELECT * 
FROM SINHVIEN, KHOA
WHERE MAKH='TH'
ORDER BY TENSV
--CAU 3
SELECT MASV, HOSV, TENSV, NGAYSINH, HOCBONG, MAKH
FROM SINHVIEN
WHERE HOCBONG != 0 AND NAM = 0
--CAU 4
SELECT MASV, HOSV, TENSV, NGAYSINH, HOCBONG
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE NAM = 1 AND (TENKHOA = 'TIN HOC' OR TENKHOA = 'ANH VAN')
ORDER BY TENSV ASC
--CAU 5
SELECT MAKH, MASV, HOSV, TENSV, NGAYSINH, HOCBONG
FROM SINHVIEN
WHERE NAM = 1
ORDER BY MAKH ASC
--CAU 6
SELECT MAKH, MASV, HOSV, TENSV, NGAYSINH, HOCBONG, YEAR(GETDATE()) - YEAR(NGAYSINH) as TUOI
FROM SINHVIEN
WHERE NAM = 1 AND CAST(YEAR(GETDATE()) - YEAR(NGAYSINH) AS int) > 18 AND CAST(YEAR(GETDATE()) - YEAR(NGAYSINH) AS int) < 25
ORDER BY MAKH ASC
--CAU 7
SELECT MASV, HOSV, TENSV, NGAYSINH, HOCBONG
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE HOCBONG > 120000 AND (TENKHOA = 'TIN HOC' OR TENKHOA = 'ANH VAN')
ORDER BY MAKH ASC
--CAU 8
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, TENMN, DIEM, CASE WHEN DIEM >= 5 THEN 'DAT' ELSE 'ROT' END AS KETQUA
FROM SINHVIEN, MONHOC, KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV AND MONHOC.MAMH = KETQUA.MAMH
--CAU 9
	--NHU CAU 8
--CAU 10
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, TENMN, DIEM, CASE WHEN DIEM >= 5 THEN 'DAT' ELSE 'ROT' END AS KETQUA
FROM SINHVIEN, MONHOC, KETQUA
WHERE TENSV LIKE'Lan' AND SINHVIEN.MASV = KETQUA.MASV AND MONHOC.MAMH = KETQUA.MAMH
--CAU 11
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, TENMN, DIEM, CASE WHEN DIEM >= 5 THEN 'DAT' ELSE 'ROT' END AS KETQUA
FROM SINHVIEN, MONHOC, KETQUA
WHERE TENSV LIKE 'L%' AND SINHVIEN.MASV = KETQUA.MASV AND MONHOC.MAMH = KETQUA.MAMH
--CAU 12
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, TENMN, DIEM, CASE WHEN DIEM >= 5 THEN 'DAT' ELSE 'ROT' END AS KETQUA
FROM SINHVIEN, MONHOC, KETQUA
WHERE (TENSV LIKE 'T%' OR TENSV LIKE 'H%') AND SINHVIEN.MASV = KETQUA.MASV AND MONHOC.MAMH = KETQUA.MAMH
--CAU 13
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, TENMN, DIEM
FROM SINHVIEN, MONHOC, KETQUA, KHOA
WHERE SINHVIEN.MASV = KETQUA.MASV AND MONHOC.MAMH = KETQUA.MAMH
		AND SINHVIEN.MAKH = KHOA.MAKHOA AND (TENKHOA = 'TIN HOC' OR TENKHOA = 'ANH VAN')
ORDER BY DIEM DESC
--CAU 14
SELECT MASV, HOSV, TENSV, NAM, CAST(YEAR(GETDATE()) - YEAR(NGAYSINH) AS int) as TUOI,MAKHOA, TENKHOA
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
ORDER BY MAKH ASC, NAM DESC
--CAU 15
SELECT SINHVIEN.MASV, HOSV, TENSV, MONHOC.MAMH, MONHOC.TENMN, DIEM
FROM SINHVIEN INNER JOIN KETQUA ON KETQUA.MASV = SINHVIEN.MASV, MONHOC
WHERE MONHOC.MAMH = KETQUA.MAMH AND DIEM >=9
--CAU 16
SELECT SUM(HOCBONG) AS TONGHOCBONG
FROM SINHVIEN
--CAU 17
SELECT SUM(HOCBONG) AS TONGHOCBONG, AVG(HOCBONG) AS TRUNGBINH, MAX(HOCBONG) AS HOCBONGLONNHAT,
		MIN(HOCBONG) AS HOCBONGNHONHAT
FROM SINHVIEN
--CAU 18
SELECT MAX(HOCBONG) AS HBLONNHAT
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE TENKHOA = 'TIN HOC'
--CAU 19
SELECT MASV, HOSV, TENSV, NAM, HOCBONG
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE TENKHOA = 'TIN HOC' AND HOCBONG = (SELECT MAX(HOCBONG) AS HBLONNHAT
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE TENKHOA = 'TIN HOC')
--CAU 20
SELECT COUNT(MASV) AS SOSINHVIEN
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE TENKHOA = 'TIN HOC'
--CAU 21
SELECT MAKH, SUM(HOCBONG) AS TONGHOCBONG
FROM SINHVIEN inner join KHOA on SINHVIEN.MAKH = KHOA.MAKHOA
GROUP BY MAKH
--CAU 22
SELECT MAKH, TENKHOA, SUM(HOCBONG) AS TONGHOCBONG
FROM SINHVIEN inner join KHOA on SINHVIEN.MAKH = KHOA.MAKHOA
GROUP BY MAKH, TENKHOA
--CAU 23
SELECT SINHVIEN.MASV, AVG(DIEM) AS DIEMTB  
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV = KETQUA.MASV
GROUP BY SINHVIEN.MASV
--CAU 24
SELECT SINHVIEN.MASV, SINHVIEN.HOSV, SINHVIEN.TENSV, AVG(DIEM) AS DIEMTB  
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV = KETQUA.MASV
GROUP BY SINHVIEN.MASV, SINHVIEN.TENSV, SINHVIEN.HOSV
--CAU 25
SELECT SINHVIEN.MASV, AVG(DIEM) AS DIEMTB  
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV = KETQUA.MASV, KHOA
WHERE SINHVIEN.MAKH = KHOA.MAKHOA AND TENKHOA = 'TIN HOC'
GROUP BY SINHVIEN.MASV
--CAU 26
SELECT SINHVIEN.MASV, SINHVIEN.HOSV, SINHVIEN.TENSV, AVG(DIEM) AS DIEMTB  
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV = KETQUA.MASV
GROUP BY SINHVIEN.MASV, SINHVIEN.TENSV, SINHVIEN.HOSV
HAVING AVG(DIEM) >= 5
--CAU 27
SELECT SINHVIEN.MASV, SINHVIEN.HOSV, SINHVIEN.TENSV, AVG(DIEM) AS DIEMTB  
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV = KETQUA.MASV, KHOA
WHERE KHOA.MAKHOA = SINHVIEN.MAKH AND TENKHOA = 'TIN HOC'
GROUP BY SINHVIEN.MASV, SINHVIEN.TENSV, SINHVIEN.HOSV
HAVING AVG(DIEM) >= 5
--CAU 28
SELECT MAX(HOCBONG) AS HBLONNHAT, AVG(HOCBONG) AS TRUNGBINH,
		MIN(HOCBONG) AS HOCBONGNHONHAT
FROM SINHVIEN INNER JOIN KHOA ON SINHVIEN.MAKH = KHOA.MAKHOA
WHERE TENKHOA = 'TIN HOC' AND HOCBONG != 0
--CÂU 29
SELECT MAX(DIEM) AS DIEMLONNHAT, MIN(DIEM) AS DIEMNHONHAT
FROM SINHVIEN INNER JOIN KETQUA ON SINHVIEN.MASV=KETQUA.MASV
--CÂU 30
SELECT MAX(DIEM) AS DIEMLONNHAT, MIN(DIEM) AS DIEMNHONHAT
FROM SINHVIEN,KHOA,KETQUA 
WHERE TENKHOA = 'TIN HOC' AND SINHVIEN.MAKH=KHOA.MAKHOA AND SINHVIEN.MASV=KETQUA.MASV
---CÂU 31
SELECT SINHVIEN.MASV, AVG(DIEM) AS DIEMTRUNGBINH, CASE WHEN AVG(DIEM)>=5 AND MIN(DIEM)> 3 THEN 'DAT' ELSE 'ROT' END AS KETQUA
FROM KETQUA, SINHVIEN
WHERE SINHVIEN.MASV=KETQUA.MASV
GROUP BY SINHVIEN.MASV



